<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>class Dependabot::Linguist::DependabotFileValidator - RDoc Documentation</title>

  <meta name="keywords" content="ruby,class,Dependabot::Linguist::DependabotFileValidator">

    <meta name="description" content="class Dependabot::Linguist::DependabotFileValidator: Reads an existing dependabot file and determines how it should be updated to meet the suggested entried to the updates list coming from repository&#39;s d">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<div id="navigation-toggle" role="button" tabindex="0" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="navigation">
  <span aria-hidden="true">&#9776;</span>
</div>


<nav id="navigation" role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search (/) for a class, method, ..." spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
  
  <div id="parent-class-section" class="nav-section">
  <h3>Ancestors</h3>
  <ul><li>Object</li></ul>
</div>

  
  
  
  <div class="nav-section">
    <h3>Class Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-c-checking_exists">checking_exists</a></li>
      <li ><a href="#method-c-flatten_ecodirs_to_ecodir">flatten_ecodirs_to_ecodir</a></li>
      <li ><a href="#method-c-new">new</a></li>
    </ul>
  </div>



  <div class="nav-section">
    <h3>Instance Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-i-commit_new_config">commit_new_config</a></li>
      <li ><a href="#method-i-config_drift">config_drift</a></li>
      <li ><a href="#method-i-confirm_config_version_is_valid">confirm_config_version_is_valid</a></li>
      <li ><a href="#method-i-dependabot_file_path">dependabot_file_path</a></li>
      <li ><a href="#method-i-ecodir_is_ignored">ecodir_is_ignored</a></li>
      <li ><a href="#method-i-existing_config">existing_config</a></li>
      <li ><a href="#method-i-load_ecosystem_directories">load_ecosystem_directories</a></li>
      <li ><a href="#method-i-meta_config">meta_config</a></li>
      <li ><a href="#method-i-new_config">new_config</a></li>
      <li ><a href="#method-i-parsed_schedule_interval">parsed_schedule_interval</a></li>
      <li ><a href="#method-i-write_new_config">write_new_config</a></li>
    </ul>
  </div>



  <footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.13.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

</nav>

<main role="main" aria-labelledby="class-Dependabot::Linguist::DependabotFileValidator">
  
  
    <ol role="navigation" aria-label="breadcrumb" class="breadcrumb">
      
      <li>
        
        <a href="../../Dependabot.html">Dependabot</a><span>::</span>
        
      </li>
      
      <li>
        
        <a href="../../Dependabot/Linguist.html">Linguist</a><span>::</span>
        
      </li>
      
      <li>
        
        <span>DependabotFileValidator</span>
        
      </li>
      
    </ol>
  

  <h1 id="class-Dependabot::Linguist::DependabotFileValidator" class="anchor-link class">
    class Dependabot::Linguist::DependabotFileValidator
  </h1>

  <section class="description">
    
<p>Reads an existing dependabot file and determines how it should be updated to meet the suggested entried to the updates list coming from repository’s directories_per_ecosystem_validated_by_dependabot</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section anchor-link">


    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
        <dt id="CONFIG_FILE_PATH">CONFIG_FILE_PATH
        <dd>
          
        <dt id="YAML_FILE_PATH">YAML_FILE_PATH
        <dd>
          
        <dt id="YML_FILE_PATH">YML_FILE_PATH
        <dd>
          
      </dl>
    </section>



     <section id="public-class-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-checking_exists" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-checking_exists" title="Link to this method">
                <span class="method-name">checking_exists</span>
                <span class="method-args">(checking, exists)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="checking_exists-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">checking_exists</span>(<span class="ruby-identifier">checking</span>, <span class="ruby-identifier">exists</span>)
  <span class="ruby-identifier">exists</span>[<span class="ruby-string">&quot;package-ecosystem&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">checking</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">exists</span>[<span class="ruby-string">&quot;directory&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">checking</span>[<span class="ruby-value">1</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-c-flatten_ecodirs_to_ecodir" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-flatten_ecodirs_to_ecodir" title="Link to this method">
                <span class="method-name">flatten_ecodirs_to_ecodir</span>
                <span class="method-args">(ecosystem_directories_map)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="flatten_ecodirs_to_ecodir-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 94</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">flatten_ecodirs_to_ecodir</span>(<span class="ruby-identifier">ecosystem_directories_map</span>)
  <span class="ruby-identifier">ecosystem_directories_map</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">eco</span>, <span class="ruby-identifier">dirs</span><span class="ruby-operator">|</span> <span class="ruby-identifier">dirs</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">eco</span>, <span class="ruby-identifier">dir</span>] } }.<span class="ruby-identifier">flatten</span>(<span class="ruby-value">1</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-c-new" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-new" title="Link to this method">
                <span class="method-name">new</span>
                <span class="method-args">(repo_path, remove_undiscovered: false, update_existing: true, minimum_interval: &quot;weekly&quot;, max_open_pull_requests_limit: 5, verbose: false)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 12</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">repo_path</span>, <span class="ruby-value">remove_undiscovered:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">update_existing:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">minimum_interval:</span> <span class="ruby-string">&quot;weekly&quot;</span>, <span class="ruby-value">max_open_pull_requests_limit:</span> <span class="ruby-value">5</span>, <span class="ruby-value">verbose:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-ivar">@repo</span> = <span class="ruby-constant">Rugged</span><span class="ruby-operator">::</span><span class="ruby-constant">Repository</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">repo_path</span>)
  <span class="ruby-ivar">@remove_undiscovered</span> = <span class="ruby-identifier">remove_undiscovered</span>
  <span class="ruby-ivar">@update_existing</span> = <span class="ruby-identifier">update_existing</span>
  <span class="ruby-ivar">@minimum_interval</span> = <span class="ruby-identifier">minimum_interval</span>
  <span class="ruby-ivar">@max_open_pull_requests_limit</span> = [<span class="ruby-identifier">max_open_pull_requests_limit</span>, <span class="ruby-value">0</span>].<span class="ruby-identifier">max</span>
  <span class="ruby-ivar">@verbose</span> = <span class="ruby-identifier">verbose</span>
  <span class="ruby-ivar">@load_ecosystem_directories</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-commit_new_config" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-commit_new_config" title="Link to this method">
                <span class="method-name">commit_new_config</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="commit_new_config-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 214</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">commit_new_config</span>
  <span class="ruby-identifier">new_branch</span> = <span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">create_branch</span>(<span class="ruby-string">&quot;dependabot-linguist_auto-config-update&quot;</span>)
  <span class="ruby-identifier">in_repo</span> = <span class="ruby-node">&quot;cd #{@repo.path.delete_suffix(&quot;/.git/&quot;)} &amp;&amp;&quot;</span>
  <span class="ruby-node">`#{&quot;#{in_repo} git checkout #{new_branch.name}&quot;}`</span>
  <span class="ruby-identifier">write_new_config</span>
  <span class="ruby-node">`#{&quot;#{in_repo} git add #{dependabot_file_path}&quot;}`</span>
  <span class="ruby-node">`#{&quot;#{in_repo} git commit -m \&quot;Auto update #{dependabot_file_path} -- dependabot-linguist\&quot;&quot;}`</span>
  <span class="ruby-node">`#{&quot;#{in_repo} git push --set-upstream #{@repo.remotes[&quot;origin&quot;].name} #{new_branch.name}&quot;}`</span>
  <span class="ruby-node">`#{&quot;#{in_repo} gh pr create --fill&quot;}`</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>The expected environment to run this final step in should have ‘git’ AND ‘gh’ available as commands to run, and calls out to a subshell to run them as set up by the environment that runs this, rather than requiring credentials being provided to this class.</p>
        </div>


      </div>

      <div id="method-i-config_drift" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-config_drift" title="Link to this method">
                <span class="method-name">config_drift</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="config_drift-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 108</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">config_drift</span>
  <span class="ruby-identifier">confirm_config_version_is_valid</span>
  <span class="ruby-ivar">@config_drift</span> <span class="ruby-operator">||=</span> {}.<span class="ruby-identifier">tap</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">this</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ecodir_list</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">flatten_ecodirs_to_ecodir</span>(<span class="ruby-identifier">load_ecosystem_directories</span>)
    <span class="ruby-identifier">this</span>[<span class="ruby-constant">ConfigDriftStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">ALREADY_IN</span>] = []
    <span class="ruby-identifier">this</span>[<span class="ruby-constant">ConfigDriftStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">TO_BE_ADDED</span>] = []
    <span class="ruby-identifier">this</span>[<span class="ruby-constant">ConfigDriftStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">UNDISCOVERED</span>] = []
    <span class="ruby-identifier">this</span>.<span class="ruby-identifier">freeze</span>
    <span class="ruby-identifier">ecodir_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">checking_ecodir</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ecodir_is_ignored</span>(<span class="ruby-identifier">checking_ecodir</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">checking_ecodir</span>[<span class="ruby-value">1</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">existing_config</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">existing_config</span>[<span class="ruby-string">&quot;updates&quot;</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">existed_ecodir</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">existing_config</span>[<span class="ruby-string">&quot;updates&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">existing_ecodir</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">checking_exists</span>(<span class="ruby-identifier">checking_ecodir</span>, <span class="ruby-identifier">existing_ecodir</span>)
            <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{ConfigDriftStatus::ALREADY_IN}; {#{checking_ecodir[0]} @ #{checking_ecodir[1]}}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
            <span class="ruby-identifier">this</span>[<span class="ruby-constant">ConfigDriftStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">ALREADY_IN</span>].<span class="ruby-identifier">append</span>(<span class="ruby-identifier">checking_ecodir</span>)
            <span class="ruby-identifier">existed_ecodir</span> = <span class="ruby-identifier">existing_ecodir</span>
            <span class="ruby-keyword">break</span> <span class="ruby-comment"># existing_ecodir</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-comment"># break to here</span>
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">existed_ecodir</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-comment"># checking_ecodir</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment"># If we didn&#39;t break -&gt; next, then we&#39;ve got a checking_ecodir</span>
      <span class="ruby-comment"># that we didn&#39;t find already present in the existing ecodirs.</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{ConfigDriftStatus::TO_BE_ADDED}; {#{checking_ecodir[0]} @ #{checking_ecodir[1]}}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
      <span class="ruby-identifier">this</span>[<span class="ruby-constant">ConfigDriftStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">TO_BE_ADDED</span>].<span class="ruby-identifier">append</span>(<span class="ruby-identifier">checking_ecodir</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">existing_config</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">existing_config</span>[<span class="ruby-string">&quot;updates&quot;</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">existing_config</span>[<span class="ruby-string">&quot;updates&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">existing_ecodir</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">existed_ecodir</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">ecodir_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">checking_ecodir</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ecodir_is_ignored</span>(<span class="ruby-identifier">checking_ecodir</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">checking_ecodir</span>[<span class="ruby-value">1</span>])
          <span class="ruby-identifier">existed_ecodir</span> = <span class="ruby-identifier">checking_ecodir</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">checking_exists</span>(<span class="ruby-identifier">checking_ecodir</span>, <span class="ruby-identifier">existing_ecodir</span>)
          <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">existed_ecodir</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">existed_ecodir</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{ConfigDriftStatus::UNDISCOVERED}; {#{existing_ecodir[&quot;package-ecosystem&quot;]} @ #{existing_ecodir[&quot;directory&quot;]}} that wasn&#39;t found by us!!&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@verbose</span>
          <span class="ruby-identifier">this</span>[<span class="ruby-constant">ConfigDriftStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">UNDISCOVERED</span>].<span class="ruby-identifier">append</span>([<span class="ruby-identifier">existing_ecodir</span>[<span class="ruby-string">&quot;package-ecosystem&quot;</span>], <span class="ruby-identifier">existing_ecodir</span>[<span class="ruby-string">&quot;directory&quot;</span>]])
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-confirm_config_version_is_valid" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-confirm_config_version_is_valid" title="Link to this method">
                <span class="method-name">confirm_config_version_is_valid</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="confirm_config_version_is_valid-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">confirm_config_version_is_valid</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">StandardError</span>(<span class="ruby-string">&quot;The existing config has a version other than 2&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">existing_config</span>[<span class="ruby-string">&quot;version&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-dependabot_file_path" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-dependabot_file_path" title="Link to this method">
                <span class="method-name">dependabot_file_path</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="dependabot_file_path-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">dependabot_file_path</span>
  <span class="ruby-ivar">@dependabot_file_path</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">blob_at</span>(<span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">head</span>.<span class="ruby-identifier">target_id</span>, <span class="ruby-constant">YML_FILE_PATH</span>)
    <span class="ruby-comment"># the yml extension is preferred by GitHub, so even though this</span>
    <span class="ruby-comment"># returns the same as the `else`, check it before YAML.</span>
    <span class="ruby-constant">YML_FILE_PATH</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">blob_at</span>(<span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">head</span>.<span class="ruby-identifier">target_id</span>, <span class="ruby-constant">YAML_FILE_PATH</span>)
    <span class="ruby-constant">YAML_FILE_PATH</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@existing_config</span> = { <span class="ruby-string">&quot;version&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">2</span>, <span class="ruby-string">&quot;updates&quot;</span> <span class="ruby-operator">=&gt;</span> [] }
    <span class="ruby-constant">YML_FILE_PATH</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>rubocop:disable Layout/IndentationWidth, Layout/ElseAlignment, Layout/EndAlignment</p>
        </div>


      </div>

      <div id="method-i-ecodir_is_ignored" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-ecodir_is_ignored" title="Link to this method">
                <span class="method-name">ecodir_is_ignored</span>
                <span class="method-args">(eco, dir)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="ecodir_is_ignored-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 72</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ecodir_is_ignored</span>(<span class="ruby-identifier">eco</span>, <span class="ruby-identifier">dir</span>)
  ((((<span class="ruby-identifier">meta_config</span>[<span class="ruby-string">&quot;ignore&quot;</span>] <span class="ruby-operator">||</span> {})[<span class="ruby-string">&quot;directory&quot;</span>] <span class="ruby-operator">||</span> {})[<span class="ruby-identifier">dir</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">any?</span> <span class="ruby-identifier">eco</span>) <span class="ruby-operator">||</span> ((((<span class="ruby-identifier">meta_config</span>[<span class="ruby-string">&quot;ignore&quot;</span>] <span class="ruby-operator">||</span> {})[<span class="ruby-string">&quot;ecosystem&quot;</span>] <span class="ruby-operator">||</span> {})[<span class="ruby-identifier">eco</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">any?</span> <span class="ruby-identifier">dir</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Is a yaml config file exists that looks like</p>

<p>ignore:</p>

<pre>directory:
  /path/to/somewhere:
  - some_ecosystem
ecosystem:
  some_other_ecosystem:
  - /path/to/somewhere_else</pre>

<p>then both (some_ecosystem, “/path/to/somewhere”) and (some_other_ecosystem, “/path/to/somewhere_else”) should be “ignored” by this system.</p>
        </div>


      </div>

      <div id="method-i-existing_config" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-existing_config" title="Link to this method">
                <span class="method-name">existing_config</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="existing_config-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 43</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">existing_config</span>
  <span class="ruby-identifier">dependabot_file_path</span> <span class="ruby-comment"># to = {} if the file doesn&#39;t exist or isn&#39;t committed.</span>
  <span class="ruby-comment"># @existing_config ||= YAML.load_file(File.join(@repo.path, dependabot_file_path))</span>
  <span class="ruby-ivar">@existing_config</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">safe_load</span>(<span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">blob_at</span>(<span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">head</span>.<span class="ruby-identifier">target_id</span>, <span class="ruby-identifier">dependabot_file_path</span>).<span class="ruby-identifier">content</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-load_ecosystem_directories" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-load_ecosystem_directories" title="Link to this method">
                <span class="method-name">load_ecosystem_directories</span>
                <span class="method-args">(incoming: @load_ecosystem_directories)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="load_ecosystem_directories-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_ecosystem_directories</span>(<span class="ruby-value">incoming:</span> <span class="ruby-ivar">@load_ecosystem_directories</span>)
  <span class="ruby-ivar">@load_ecosystem_directories</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@load_ecosystem_directories</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">incoming</span>
    <span class="ruby-ivar">@load_ecosystem_directories</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@config_drift</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@new_config</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@load_ecosystem_directories</span> = <span class="ruby-identifier">incoming</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Expects an input that is the output of <a href="Repository.html#method-c-new"><code>::Dependabot::Linguist::Repository.new</code></a>(~)‘s directories_per_ecosystem_validated_by_dependabot, which should be a map {“&lt;package_ecosystem&gt;” =&gt; [“&lt;folder_path&gt;”, …], …}</p>
        </div>


      </div>

      <div id="method-i-meta_config" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-meta_config" title="Link to this method">
                <span class="method-name">meta_config</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="meta_config-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">meta_config</span>
  <span class="ruby-ivar">@meta_config</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">blob_at</span>(<span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">head</span>.<span class="ruby-identifier">target_id</span>, <span class="ruby-constant">CONFIG_FILE_PATH</span>)
    <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">safe_load</span>(<span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">blob_at</span>(<span class="ruby-ivar">@repo</span>.<span class="ruby-identifier">head</span>.<span class="ruby-identifier">target_id</span>, <span class="ruby-constant">CONFIG_FILE_PATH</span>).<span class="ruby-identifier">content</span>)
  <span class="ruby-keyword">else</span>
    {}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-new_config" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-new_config" title="Link to this method">
                <span class="method-name">new_config</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="new_config-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 162</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_config</span>
  <span class="ruby-identifier">confirm_config_version_is_valid</span>
  <span class="ruby-ivar">@new_config</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">safe_load</span>(<span class="ruby-identifier">existing_config</span>.<span class="ruby-identifier">to_yaml</span>).<span class="ruby-identifier">tap</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">this</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">this</span>[<span class="ruby-string">&quot;updates&quot;</span>] = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">this</span>[<span class="ruby-string">&quot;updates&quot;</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment"># If &quot;remove_undiscovered&quot; is set, then set this to reject any</span>
    <span class="ruby-comment"># updates that are in the list of those undiscovered. Removing</span>
    <span class="ruby-comment"># is not safe from inside each, so reject instead.</span>
    <span class="ruby-identifier">this</span>[<span class="ruby-string">&quot;updates&quot;</span>] = <span class="ruby-identifier">this</span>[<span class="ruby-string">&quot;updates&quot;</span>].<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">u</span><span class="ruby-operator">|</span> <span class="ruby-identifier">config_drift</span>[<span class="ruby-constant">ConfigDriftStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">UNDISCOVERED</span>].<span class="ruby-identifier">any?</span> [<span class="ruby-identifier">u</span>[<span class="ruby-string">&quot;package-ecosystem&quot;</span>], <span class="ruby-identifier">u</span>[<span class="ruby-string">&quot;directory&quot;</span>]] } <span class="ruby-keyword">if</span> <span class="ruby-ivar">@remove_undiscovered</span>
    <span class="ruby-comment"># Next, go through and update any existing.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@update_existing</span>
      <span class="ruby-identifier">this</span>[<span class="ruby-string">&quot;updates&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">existing_update</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">config_drift</span>[<span class="ruby-constant">ConfigDriftStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">ALREADY_IN</span>].<span class="ruby-identifier">any?</span> [<span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;package-ecosystem&quot;</span>], <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;directory&quot;</span>]]
          <span class="ruby-comment"># Confirm that the already present entry is good enough</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;schedule&quot;</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Hash</span>
            <span class="ruby-identifier">new_interval</span> = <span class="ruby-identifier">parsed_schedule_interval</span>(<span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;schedule&quot;</span>][<span class="ruby-string">&quot;interval&quot;</span>])
            <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;schedule&quot;</span>][<span class="ruby-string">&quot;interval&quot;</span>] = <span class="ruby-identifier">new_interval</span>
            <span class="ruby-comment"># if it&#39;s not weekly anymore remove day if it&#39;s specified.</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;schedule&quot;</span>][<span class="ruby-string">&quot;interval&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;weekly&quot;</span>
              <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;schedule&quot;</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;day&quot;</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;schedule&quot;</span>] = { <span class="ruby-string">&quot;interval&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parsed_schedule_interval</span>(<span class="ruby-string">&quot;monthly&quot;</span>) }
          <span class="ruby-keyword">end</span>
          <span class="ruby-comment"># Confirm the open-pull-requests-limit</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;open-pull-requests-limit&quot;</span>]
            <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;open-pull-requests-limit&quot;</span>] = [<span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;open-pull-requests-limit&quot;</span>], <span class="ruby-ivar">@max_open_pull_requests_limit</span>].<span class="ruby-identifier">min</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;open-pull-requests-limit&quot;</span>] = <span class="ruby-ivar">@max_open_pull_requests_limit</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">existing_update</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;open-pull-requests-limit&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">existing_update</span>[<span class="ruby-string">&quot;open-pull-requests-limit&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value">5</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">config_drift</span>[<span class="ruby-constant">ConfigDriftStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">TO_BE_ADDED</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tba</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">new_update</span> = { <span class="ruby-string">&quot;package-ecosystem&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">tba</span>[<span class="ruby-value">0</span>], <span class="ruby-string">&quot;directory&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">tba</span>[<span class="ruby-value">1</span>] }
      <span class="ruby-identifier">new_update</span>[<span class="ruby-string">&quot;schedule&quot;</span>] = { <span class="ruby-string">&quot;interval&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">parsed_schedule_interval</span>(<span class="ruby-string">&quot;monthly&quot;</span>) }
      <span class="ruby-identifier">new_update</span>[<span class="ruby-string">&quot;open-pull-requests-limit&quot;</span>] = <span class="ruby-ivar">@max_open_pull_requests_limit</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@max_open_pull_requests_limit</span> <span class="ruby-operator">!=</span> <span class="ruby-value">5</span>
      <span class="ruby-identifier">this</span>[<span class="ruby-string">&quot;updates&quot;</span>].<span class="ruby-identifier">append</span>(<span class="ruby-identifier">new_update</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-parsed_schedule_interval" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-parsed_schedule_interval" title="Link to this method">
                <span class="method-name">parsed_schedule_interval</span>
                <span class="method-args">(interval)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="parsed_schedule_interval-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 153</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parsed_schedule_interval</span>(<span class="ruby-identifier">interval</span>)
  <span class="ruby-identifier">intervals</span> = [<span class="ruby-string">&quot;daily&quot;</span>, <span class="ruby-string">&quot;weekly&quot;</span>, <span class="ruby-string">&quot;monthly&quot;</span>].<span class="ruby-identifier">freeze</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">intervals</span>.<span class="ruby-identifier">any?</span> <span class="ruby-ivar">@minimum_interval</span>
    <span class="ruby-identifier">intervals</span>[[<span class="ruby-identifier">intervals</span>.<span class="ruby-identifier">find_index</span>(<span class="ruby-ivar">@minimum_interval</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">intervals</span>.<span class="ruby-identifier">length</span><span class="ruby-value">-1</span>), <span class="ruby-identifier">intervals</span>.<span class="ruby-identifier">find_index</span>(<span class="ruby-identifier">interval</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">intervals</span>.<span class="ruby-identifier">length</span><span class="ruby-value">-1</span>)].<span class="ruby-identifier">min</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">interval</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-write_new_config" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-write_new_config" title="Link to this method">
                <span class="method-name">write_new_config</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="write_new_config-source">
            <pre><span class="ruby-comment"># File lib/dependabot/linguist/dependabot_file_validator.rb, line 204</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">write_new_config</span>
  <span class="ruby-identifier">full_file_path</span> = <span class="ruby-node">&quot;#{@repo.path.delete_suffix(&quot;/.git/&quot;)}/#{dependabot_file_path}&quot;</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">full_file_path</span>)
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">full_file_path</span>, <span class="ruby-string">&quot;w&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">new_config</span>.<span class="ruby-identifier">to_yaml</span>) } <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_config</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">existing_config</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

    </section>

  </section>
</main>

